<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Listas Personalizadas</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; }
        .app-container { max-width: 500px; margin: auto; background: white; min-height: 100vh; display: flex; flex-direction: column; }
        
        /* NavegaciÃ³n */
        .tabs { display: flex; background: #2c3e50; color: white; position: sticky; top: 0; z-index: 100; }
        .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; font-size: 14px; }
        .tab.active { border-bottom: 4px solid #3498db; background: rgba(255,255,255,0.1); }
        
        .content { padding: 20px; display: none; }
        .content.active { display: block; }

        /* CategorÃ­as DinÃ¡micas */
        .category-header { background: #34495e; padding: 10px; font-weight: bold; color: white; border-radius: 5px; margin-top: 20px; display: flex; justify-content: space-between; }
        .item { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid #eee; background: white; }
        
        /* Formulario */
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #34495e; }
        input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        .btn-add { background: #27ae60; color: white; border: none; width: 100%; padding: 15px; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; }
        .btn-del { background: #e74c3c; color: white; border: none; padding: 5px 8px; border-radius: 4px; font-size: 11px; cursor: pointer; }
        
        .controls { display: flex; align-items: center; gap: 8px; }
        .count-badge { background: #f8f9fa; padding: 5px 10px; border-radius: 5px; font-weight: bold; border: 1px solid #ddd; min-width: 25px; text-align: center; }
        .btn-circle { width: 32px; height: 32px; border-radius: 50%; border: none; background: #3498db; color: white; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="tabs">
        <div class="tab active" onclick="openTab('ver-todo')">ðŸ“‹ Mis Listas</div>
        <div class="tab" onclick="openTab('nuevo-item')">âž• Crear/AÃ±adir</div>
    </div>

    <div id="ver-todo" class="content active">
        <div id="lista-dinamica">Cargando tus listas...</div>
    </div>

    <div id="nuevo-item" class="content">
        <h3>AÃ±adir Producto</h3>
        
        <label>Nombre de la Lista (Ej: Super, FerreterÃ­a):</label>
        <input type="text" id="listName" placeholder="Â¿A quÃ© lista pertenece?">

        <label>Nombre del Producto:</label>
        <input type="text" id="prodName" placeholder="Ej: Tornillos, Arroz...">
        
        <button class="btn-add" onclick="guardar()">Guardar en la Lista</button>
        <p style="font-size: 12px; color: #7f8c8d; margin-top: 10px;">* Si el nombre de la lista ya existe, el producto se agregarÃ¡ allÃ­.</p>
    </div>
</div>

<script>
    const firebaseConfig = {
  apiKey: "AIzaSyAaggFJT_KbLGsuYkX_JBg6OTxRaiTh5VM",
  authDomain: "inventario-bodega-d944a.firebaseapp.com",
  databaseURL: "https://inventario-bodega-d944a-default-rtdb.firebaseio.com",
  projectId: "inventario-bodega-d944a",
  storageBucket: "inventario-bodega-d944a.firebasestorage.app",
  messagingSenderId: "195866007718",
  appId: "1:195866007718:web:2b412e1e62efbb51043c67",
  measurementId: "G-795YYC8JLT"
};
  
   firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function openTab(id) {
        document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(event) event.currentTarget.classList.add('active');
    }

    // Leer datos y organizar por el nombre de lista que el usuario decidiÃ³
    db.ref('productos').on('value', snapshot => {
        const container = document.getElementById('lista-dinamica');
        container.innerHTML = '';
        
        if (!snapshot.exists()) {
            container.innerHTML = '<p style="text-align:center; color: #7f8c8d;">No tienes listas creadas.</p>';
            return;
        }

        const listas = {};
        snapshot.forEach(child => {
            const data = child.val();
            const nombreLista = data.lista || 'General';
            if (!listas[nombreLista]) listas[nombreLista] = [];
            listas[nombreLista].push({ id: child.key, ...data });
        });

        // Crear las secciones en pantalla
        for (const nombre in listas) {
            let sectionHtml = `<div class="category-header"><span>ðŸ“‚ ${nombre}</span></div>`;
            listas[nombre].forEach(item => {
                sectionHtml += `
                <div class="item">
                    <div>
                        <strong>${item.nombre}</strong>
                        <button class="btn-del" onclick="borrar('${item.id}')">Eliminar</button>
                    </div>
                    <div class="controls">
                        <button class="btn-circle" onclick="cambiar('${item.id}', -1)">-</button>
                        <span class="count-badge">${item.cantidad}</span>
                        <button class="btn-circle" onclick="cambiar('${item.id}', 1)">+</button>
                    </div>
                </div>`;
            });
            container.innerHTML += sectionHtml;
        }
    });

    function guardar() {
        const listaDestino = document.getElementById('listName').value.trim();
        const productoNombre = document.getElementById('prodName').value.trim();
        
        if (listaDestino === "" || productoNombre === "") {
            alert("Por favor rellena ambos campos");
            return;
        }

        db.ref('productos').push({
            lista: listaDestino,
            nombre: productoNombre,
            cantidad: 1
        });

        // Limpiar campos y volver
        document.getElementById('prodName').value = '';
        // Dejamos el nombre de la lista por si quieres agregar varios seguidos a la misma
        openTab('ver-todo');
    }

    function cambiar(id, v) {
        db.ref('productos/' + id + '/cantidad').transaction(c => {
            const nuevo = (c || 0) + v;
            return nuevo < 0 ? 0 : nuevo; // No bajar de cero
        });
    }

    function borrar(id) {
        if(confirm("Â¿Eliminar este producto de la lista?")) {
            db.ref('productos/' + id).remove();
        }
    }
</script>
</body>
</html>